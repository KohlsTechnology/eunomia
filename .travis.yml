branches:
  only:
  - master
  - /^v\d+\.\d+\.\d+$/
sudo: required
language: go
go_import_path: github.com/KohlsTechnology/eunomia
go:
- "1.15.8"
env:
  matrix:
  - OPERATOR_SDK_VERSION=v0.17.1 KUBE_VERSION=v1.18.2 MINIKUBE_VERSION=v1.15.1 SHFMT_VERSION=v3.0.1 EUNOMIA_TEST_ENV=minikube

before_script:
- curl -LO https://git.io/get_helm.sh && chmod 700 get_helm.sh && ./get_helm.sh

jobs:
  include:
    - stage: deploy
      env:
        - OPERATOR_SDK_VERSION=v0.17.1 KUBE_VERSION=v1.18.2 MINIKUBE_VERSION=v1.15.1 SHFMT_VERSION=v3.0.1 EUNOMIA_TEST_ENV=minikube
      script: make travis-deploy-images
    - stage: deploy-release
      env:
        - OPERATOR_SDK_VERSION=v0.17.1 KUBE_VERSION=v1.18.2 MINIKUBE_VERSION=v1.15.1 SHFMT_VERSION=v3.0.1 EUNOMIA_TEST_ENV=minikube
      script: make travis-release

stages:
  - name: deploy
    if: type = push AND branch = master AND fork = false
  - name: deploy-release
    if: tag =~ /^v\d+\.\d+\.\d+$/ AND fork = false
